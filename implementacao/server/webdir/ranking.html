<!DOCTYPE html>
<html>
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <title>Guerra - Ranking</title>

    <link href="imagens/ico.png" rel="icon" type="image/png"/>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <link href="https://s3.amazonaws.com/dynatable-docs-assets/css/bootstrap-2.3.2.min.css" media="all"
          rel="stylesheet"/>

    <link href="https://s3.amazonaws.com/dynatable-docs-assets/css/jquery.dynatable.css" media="all" rel="stylesheet"/>
    <script src='https://s3.amazonaws.com/dynatable-docs-assets/js/jquery.dynatable.js' type='text/javascript'></script>

    <script src='https://s3.amazonaws.com/dynatable-docs-assets/js/highcharts.js' type='text/javascript'></script>

    <!-- Bagdes -->
    <link href="css/insignias_x40.css?ver=1.5" rel="stylesheet">
    <!---->

    <!-- Donations -->
    <link href="css/ranking.css?ver=1.5" rel="stylesheet">
    <!---->
</head>
<body>
<div id="donations">
    <h1>Donations</h1>
    <p class="center">Nós te ajudamos a se divertir e desopilar um pouco?<br> Você pode nos ajudar com o desenvolvimento
        do jogo fazendo uma doação:</p>
    <div class="donation-options">
        <div>
            PayPal
            <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank">
                <input type="hidden" name="cmd" value="_donations"/>
                <input type="hidden" name="business" value="FCTSRPCEPSUUG"/>
                <input type="hidden" name="item_name" value="PayPal"/>
                <input type="hidden" name="currency_code" value="BRL"/>
                <input class="donation-ico" type="image" src="imagens/donation_paypal.png" border="0" name="submit"
                       title="PayPal - The safer, easier way to pay online!"
                       alt="Faça doações com o botão do PayPal"/>
                <img alt="" border="0" src="https://www.paypal.com/pt_BR/i/scr/pixel.gif" width="1" height="1"/>
            </form>
        </div>
        <div>
            PagSeguro
            <form action="https://pagseguro.uol.com.br/checkout/v2/donation.html" method="post" target="_blank">
                <!-- NÃO EDITE OS COMANDOS DAS LINHAS ABAIXO -->
                <input name="receiverEmail" type="hidden" value="joselitofilhoo@gmail.com"/>
                <input name="currency" type="hidden" value="BRL"/>
                <input class="donation-ico" alt="Pague com PagSeguro - é rápido, grátis e seguro!" name="submit"
                       src="imagens/donation_pagseguro.png" type="image"/>
            </form>
        </div>
        <div>
            NuBank
            <div><img class="donation-ico" src="imagens/donation_nubank.png"/></div>
        </div>
    </div>
</div>

<div id="ranking">
    <h1>Ranking</h1>
    <div class="container">
        <table class="table table-bordered" id="ranking-players">
            <thead>
            <th class="dynatable-head insignia_size" data-dynatable-column="level"></th>
            <th class="dynatable-head" data-dynatable-column="posicaoNoRanking" data-dynatable-sorts="posicaoNoRanking">
                Posi&ccedil;&atilde;o
            </th>
            <th class="dynatable-head" data-dynatable-column="nome">Nome</th>
            <th class="dynatable-head" data-dynatable-column="pontos">Pontos</th>
            <th class="dynatable-head" data-dynatable-column="quantidadeDePartidas">Partidas</th>
            <th class="dynatable-head" data-dynatable-column="quantidadeDeVitorias">Vit&oacute;rias</th>
            <th class="dynatable-head" data-dynatable-column="quantidadeDestruido">Destru&iacute;do</th>
            <th class="dynatable-head" data-dynatable-column="eficiencia">Efici&ecirc;ncia %</th>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

<div id="levels">
    <h1>Patentes</h1>
    <div class="container">
        <div id="ranking-badges">
            <!-- Conteúdo gerado. -->
        </div>
    </div>
</div>

<script src="js/websocket/websocket.js?ver=1.5" type="text/javascript"></script>
<script src="js/mensagens.js?ver=1.5" type="text/javascript"></script>
<script src="js/comunicacao.js?ver=1.5" type="text/javascript"></script>
<script src="js/war/ranking.js?ver=1.5" type="text/javascript"></script>

<script>
    _libwebsocketRanking = new gpscheck.comunicacao.GPSWebSocket(8080);

    function posAberturaSocket(msg) {
        rankingMsg = comunicacao_ranking();
        _libwebsocketRanking.enviarObjJson(rankingMsg);
    }

    function posRecebimentoMensagemServidor(msg) {
        const jsonMensagem = JSON.parse(msg);

        const rank = [];
        for (let i = 0; i < jsonMensagem.params.ranking.length; ++i) {
            let r = jsonMensagem.params.ranking[i];
            r.level = "<div class='insignia_size insignias_x40_nv0'></div>";
            if (r.pontos > 0) {
                r.level = "<div class='insignia_size insignias_x40_nv" + ranking_levelByXp(r.pontos) + "'></div>";
            }
            rank.push(r);
        }
        $('#ranking-players').dynatable({
            dataset: {
                records: rank
            }
        });

        const badges = [];
        const limitBadges = 10;
        for (let i = 0; i < limitBadges; ++i) {
            let badge = jsonMensagem.params.badges[i];
            badge.xp = parseInt(badge.xp);
            badge.images = "<div class='insignia_size insignias_x40_nv" + badge.level + "'></div>";
            badges.push(badge);
        }

        badges.sort(function (a, b) {
            return a.xp < b.xp;
        });

        $('#ranking-badges').html('');
        let conteudo = '';
        for (let i = badges.length-1; i >= 0 ; --i) {
            const badge = badges[i];
            conteudo = '';
            conteudo += '<div class="insignia_linha">';
            conteudo += '    <div class="insignia_img">' + badge.images + '</div>';
            conteudo += '    <div class="insignia_nome">' + badge.name + '</div>';
            conteudo += '    <div class="insignia_xp">' + badge.xp + '</div>';
            conteudo += '</div>';
            $('#ranking-badges').append(conteudo);
        }
    }

    _libwebsocketRanking.FOnOpen(posAberturaSocket);
    _libwebsocketRanking.FOnMessage(posRecebimentoMensagemServidor);
    _libwebsocketRanking.iniciar();
</script>
</body>
</html>
