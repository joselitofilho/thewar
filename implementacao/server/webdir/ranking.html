<!DOCTYPE html>
<html>
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <title>Guerra - Ranking</title>

    <link href="imagens/ico.png" rel="icon" type="image/png"/>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <link href="https://s3.amazonaws.com/dynatable-docs-assets/css/bootstrap-2.3.2.min.css" media="all"
          rel="stylesheet"/>

    <link href="https://s3.amazonaws.com/dynatable-docs-assets/css/jquery.dynatable.css" media="all" rel="stylesheet"/>
    <script src='https://s3.amazonaws.com/dynatable-docs-assets/js/jquery.dynatable.js' type='text/javascript'></script>

    <script src='https://s3.amazonaws.com/dynatable-docs-assets/js/highcharts.js' type='text/javascript'></script>

    <!-- Bagdes -->
    <link href="css/insignias_x40.css?ver=2.2" rel="stylesheet">
    <link href="css/insignias_x100.css?ver=2.2" rel="stylesheet">
    <!---->

    <!-- Ranking -->
    <link href="css/ranking_evento.css?ver=2.2" rel="stylesheet">
    <!---->

    <!-- Donations -->
    <link href="css/ranking.css?ver=2.2" rel="stylesheet">
    <!---->
</head>
<body>
<div id="donations">
    <h1>Donations</h1>
    <p class="center">Nós te ajudamos a se divertir e desopilar um pouco?<br> Você pode nos ajudar com o desenvolvimento
        do jogo fazendo uma doação:</p>
    <div class="donation-options">
        <div>
            PayPal
            <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank">
                <input type="hidden" name="cmd" value="_donations"/>
                <input type="hidden" name="business" value="FCTSRPCEPSUUG"/>
                <input type="hidden" name="item_name" value="PayPal"/>
                <input type="hidden" name="currency_code" value="BRL"/>
                <input class="donation-ico" type="image" src="imagens/donation_paypal.png" border="0" name="submit"
                       title="PayPal - The safer, easier way to pay online!"
                       alt="Faça doações com o botão do PayPal"/>
                <img alt="" border="0" src="https://www.paypal.com/pt_BR/i/scr/pixel.gif" width="1" height="1"/>
            </form>
        </div>
        <div>
            PagSeguro
            <form action="https://pagseguro.uol.com.br/checkout/v2/donation.html" method="post" target="_blank">
                <!-- NÃO EDITE OS COMANDOS DAS LINHAS ABAIXO -->
                <input name="receiverEmail" type="hidden" value="joselitofilhoo@gmail.com"/>
                <input name="currency" type="hidden" value="BRL"/>
                <input class="donation-ico" alt="Pague com PagSeguro - é rápido, grátis e seguro!" name="submit"
                       src="imagens/donation_pagseguro.png" type="image"/>
            </form>
        </div>
        <div>
            NuBank
            <div><img class="donation-ico" src="imagens/donation_nubank.png"/></div>
        </div>
    </div>
    <div class="donation-counter">
        <p class="center donation-current">Meta de doações: <b>0%</b></p>
        <div class="donation-progress-bar">
            <div role="progressbar" class="donation-progress" style="width: 0%;"><!----></div>
        </div>
        <!--        <p class="center donation-last-update">Atualizado a poucos instantes.</p>-->
    </div>
</div>

<div id="guerra_mundial">
    <h1>Guerra Mundial</h1>
    <p class="center">Todo mês vamos enviar um Jogo War original para o jogador campeão dos desafios.<img id="premiacao"
                                                                                                          src="imagens/lobby/banners/premio.png"/>
    </p>
    <p>Para participar você precisa ser um doador ativo do jogo. A premiação só será enviada se atender aos seguintes
        critérios:</p>
    <ol>
        <li>O campeão ou a campeã ser um doador ativo (doação mínima de R$20,00);</li>
        <li>A meta de doações for atingida, ou seja, igual a 100%;</li>
        <li>O campeão ou a campeã ter uma pontuação mínima de 1000 pontos no ranking da guerra;</li>
        <li>Em caso de empate na pontuação geral do evento, terá a preferência o jogador ou jogadora que for melhor no
            ranking da guerra em, na seguinte ordem: pontuação, eficiência, destruído menos vezes e quantidade de
            partidas.
        </li>
    </ol>
</div>

<div id="ranking_evento">
    <h1>Ranking da Guerra</h1>
    <div id="ranking-evento">
        <div class="center">
            <div class="top3">
                <div class="two item" style="visibility: visible;">
                    <div class="pic">
                        <div class="insignia_x100_size"></div>
                    </div>
                    <div class="pos">2</div>
                    <div class="name"></div>
                    <div class="score"></div>
                </div>
                <div class="one item" style="visibility: visible;">
                    <div class="pic">
                        <div class="insignia_x100_size"></div>
                    </div>
                    <div class="pos">1</div>
                    <div class="name"></div>
                    <div class="score"></div>
                </div>
                <div class="three item" style="visibility: visible;">
                    <div class="pic">
                        <div class="insignia_x100_size"></div>
                    </div>
                    <div class="pos">3</div>
                    <div class="name"></div>
                    <div class="score"></div>
                </div>
            </div>
            <div class="list">
                <!-- Conteúdo gerado -->
            </div>
        </div>
    </div>

</div>

<div id="ranking">
    <h1>Ranking Geral</h1>
    <div class="container">
        <table class="table table-bordered" id="ranking-players">
            <thead>
            <th class="dynatable-head insignia_x40_size" data-dynatable-column="level"></th>
            <th class="dynatable-head" data-dynatable-column="posicaoNoRanking" data-dynatable-sorts="posicaoNoRanking">
                Posi&ccedil;&atilde;o
            </th>
            <th class="dynatable-head" data-dynatable-column="nome">Nome</th>
            <th class="dynatable-head" data-dynatable-column="pontos">Pontos</th>
            <th class="dynatable-head" data-dynatable-column="quantidadeDePartidas">Partidas</th>
            <th class="dynatable-head" data-dynatable-column="quantidadeDeVitorias">Vit&oacute;rias</th>
            <th class="dynatable-head" data-dynatable-column="quantidadeDestruido">Destru&iacute;do</th>
            <th class="dynatable-head" data-dynatable-column="eficiencia">Efici&ecirc;ncia %</th>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

<div id="levels">
    <h1>Patentes</h1>
    <div class="container">
        <div id="ranking-badges">
            <!-- Conteúdo gerado. -->
        </div>
    </div>
</div>

<script src="js/websocket/websocket.js?ver=2.2" type="text/javascript"></script>
<script src="js/mensagens.js?ver=2.2" type="text/javascript"></script>
<script src="js/comunicacao.js?ver=2.2" type="text/javascript"></script>
<script src="js/war/ranking.js?ver=2.2" type="text/javascript"></script>

<script>
    _libwebsocketRanking = new gpscheck.comunicacao.GPSWebSocket(8080);

    function posAberturaSocket(msg) {
        rankingMsg = comunicacao_ranking();
        _libwebsocketRanking.enviarObjJson(rankingMsg);
    }

    function posRecebimentoMensagemServidor(msg) {
        const jsonMensagem = JSON.parse(msg);

        const level_por_usuario = [];
        const rank = [];
        for (let i = 0; i < jsonMensagem.params.ranking.length; ++i) {
            let r = jsonMensagem.params.ranking[i];
            r.level = "<div class='insignia_x40_size insignias_x40_nv0'></div>";
            if (r.pontos > 0) {
                r.level = "<div class='insignia_x40_size insignias_x40_nv" + ranking_levelByXp(r.pontos) + "'></div>";
            }
            level_por_usuario[r.nome] = r.pontos;
            rank.push(r);
        }
        $('#ranking-players').dynatable({
            dataset: {
                records: rank
            }
        });

        const badges = [];
        const limitBadges = 14;
        for (let i = 0; i < limitBadges; ++i) {
            let badge = jsonMensagem.params.badges[i];
            badge.xp = parseInt(badge.xp);
            badge.images = "<div class='insignia_x40_size insignias_x40_nv" + badge.level + "'></div>";
            badges.push(badge);
        }

        badges.sort(function (a, b) {
            return a.xp < b.xp;
        });

        $('#ranking-badges').html('');
        let conteudo = '';
        for (let i = badges.length - 1; i >= 0; --i) {
            const badge = badges[i];
            conteudo = '';
            conteudo += '<div class="insignia_linha">';
            conteudo += '    <div class="insignia_img">' + badge.images + '</div>';
            conteudo += '    <div class="insignia_nome">' + badge.name + '</div>';
            conteudo += '    <div class="insignia_xp">' + badge.xp + '</div>';
            conteudo += '</div>';
            $('#ranking-badges').append(conteudo);
        }

        // Ranking da guerra
        const ranking_evento = jsonMensagem.params.ranking_evento;
        if (ranking_evento) {
            let conteudoRankingGuerra = '';
            const max_10 = Math.min(ranking_evento.length, 10);
            $('#ranking-evento .center .top3 .item.one').css('visibility', 'hidden');
            $('#ranking-evento .center .top3 .item.two').css('visibility', 'hidden');
            $('#ranking-evento .center .top3 .item.three').css('visibility', 'hidden');
            for (let i = 0; i < max_10; ++i) {
                const rank_evento = ranking_evento[i];
                if (i === 0) {
                    $('#ranking-evento .center .top3 .item.one').css('visibility', 'visible');
                    $('#ranking-evento .center .top3 .item.one .pic div').removeClass();
                    $('#ranking-evento .center .top3 .item.one .pic div').addClass('insignia_x100_size insignias_x100_nv' + ranking_levelByXp(level_por_usuario[rank_evento.nome]));
                    $('#ranking-evento .center .top3 .item.one .name').html(rank_evento.nome);
                    $('#ranking-evento .center .top3 .item.one .score').html(rank_evento.pontos);
                } else if (i === 1) {
                    $('#ranking-evento .center .top3 .item.two').css('visibility', 'visible');
                    $('#ranking-evento .center .top3 .item.two .pic div').removeClass();
                    $('#ranking-evento .center .top3 .item.two .pic div').addClass('insignia_x100_size insignias_x100_nv' + ranking_levelByXp(level_por_usuario[rank_evento.nome]));
                    $('#ranking-evento .center .top3 .item.two .name').html(rank_evento.nome);
                    $('#ranking-evento .center .top3 .item.two .score').html(rank_evento.pontos);
                } else if (i === 2) {
                    $('#ranking-evento .center .top3 .item.three').css('visibility', 'visible');
                    $('#ranking-evento .center .top3 .item.three .pic div').removeClass();
                    $('#ranking-evento .center .top3 .item.three .pic div').addClass('insignia_x100_size insignias_x100_nv' + ranking_levelByXp(level_por_usuario[rank_evento.nome]));
                    $('#ranking-evento .center .top3 .item.three .name').html(rank_evento.nome);
                    $('#ranking-evento .center .top3 .item.three .score').html(rank_evento.pontos);
                } else {
                    conteudoRankingGuerra = '';
                    conteudoRankingGuerra += '<div class="item">';
                    conteudoRankingGuerra += '    <div class="pos">' + (i + 1) + '</div>';
                    conteudoRankingGuerra += '    <div class="pic"><div class="insignia_x40_size insignias_x40_nv' + ranking_levelByXp(level_por_usuario[rank_evento.nome]) + '"></div></div>';
                    conteudoRankingGuerra += '    <div class="name">' + rank_evento.nome + '</div>';
                    conteudoRankingGuerra += '    <div class="score">' + rank_evento.pontos + '</div>';
                    conteudoRankingGuerra += '</div>';
                    $('#ranking-evento .center .list').append(conteudoRankingGuerra);
                }
            }
        }

        // Doações
        let meta_doacao = 0;
        if (jsonMensagem.params.doacoes && jsonMensagem.params.doacoes.meta) {
            meta_doacao = jsonMensagem.params.doacoes.meta;
        }
        meta_doacao = meta_doacao.toFixed(0);
        $('#donations .donation-current').html('Meta de doações: <b>' + meta_doacao + '%</b> de 100%');
        $('#donations .donation-progress').width(meta_doacao + '%');
    }

    _libwebsocketRanking.FOnOpen(posAberturaSocket);
    _libwebsocketRanking.FOnMessage(posRecebimentoMensagemServidor);
    _libwebsocketRanking.iniciar();
</script>
</body>
</html>
