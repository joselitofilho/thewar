<!DOCTYPE html>
<html>
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <title>Guerra - Ranking</title>

    <link href="imagens/ico.png" rel="icon" type="image/png"/>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <link href="https://s3.amazonaws.com/dynatable-docs-assets/css/bootstrap-2.3.2.min.css" media="all"
          rel="stylesheet"/>

    <link href="https://s3.amazonaws.com/dynatable-docs-assets/css/jquery.dynatable.css" media="all" rel="stylesheet"/>
    <script src='https://s3.amazonaws.com/dynatable-docs-assets/js/jquery.dynatable.js' type='text/javascript'></script>

    <script src='https://s3.amazonaws.com/dynatable-docs-assets/js/highcharts.js' type='text/javascript'></script>

    <!-- Bagdes -->
    <link href="css/insignias_x40.css?ver=1.3" rel="stylesheet">
    <!---->
</head>
<body>
<div class="container">
    <table class="table table-striped table-bordered" id="ranking-table">
        <thead>
        <th class="dynatable-head insignia_size" data-dynatable-column="level"></th>
        <th class="dynatable-head" data-dynatable-column="posicaoNoRanking" data-dynatable-sorts="posicaoNoRanking">Posi&ccedil;&atilde;o</th>
        <th class="dynatable-head" data-dynatable-column="nome">Nome</th>
        <th class="dynatable-head" data-dynatable-column="pontos">Pontos</th>
        <th class="dynatable-head" data-dynatable-column="quantidadeDePartidas">Partidas</th>
        <th class="dynatable-head" data-dynatable-column="quantidadeDeVitorias">Vit&oacute;rias</th>
        <th class="dynatable-head" data-dynatable-column="quantidadeDestruido">Destru&iacute;do</th>
        <th class="dynatable-head" data-dynatable-column="eficiencia">Efici&ecirc;ncia %</th>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>
<div class="container">
    <table class="table table-striped table-bordered" id="ranking-badges">
        <thead>
        <th class="dynatable-head insignia_size" data-dynatable-column="images"></th>
        <th class="dynatable-head" data-dynatable-column="xp">Pontos</th>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<script src="js/websocket/websocket.js?ver=1.3" type="text/javascript"></script>
<script src="js/mensagens.js?ver=1.3" type="text/javascript"></script>
<script src="js/comunicacao.js?ver=1.3" type="text/javascript"></script>
<script src="js/war/ranking.js?ver=1.3" type="text/javascript"></script>

<script>
    _libwebsocketRanking = new gpscheck.comunicacao.GPSWebSocket(8080);

    function posAberturaSocket(msg) {
        rankingMsg = comunicacao_ranking();
        _libwebsocketRanking.enviarObjJson(rankingMsg);
    }

    function posRecebimentoMensagemServidor(msg) {
        const jsonMensagem = JSON.parse(msg);

        const rank = [];
        for (let i = 0; i < jsonMensagem.params.ranking.length; ++i) {
            let r = jsonMensagem.params.ranking[i];
            r.level = "<div class='insignia_size insignias_x40_nv0'></div>";
            if (r.pontos > 0) {
                r.level = "<div class='insignia_size insignias_x40_nv" + ranking_levelByXp(r.pontos) + "'></div>";
            }
            rank.push(r);
        }
        $('#ranking-table').dynatable({
            dataset: {
                records: rank
            }
        });

        const badges = [];
        const limitBadges = 10;
        for (let i = 0; i < limitBadges; ++i) {
            let badge = jsonMensagem.params.badges[i];
            badge.images = "<div class='insignia_size insignias_x40_nv" + badge.level + "'></div>";
            badges.push(badge);
        }
        $('#ranking-badges').dynatable({
            dataset: {
                records: badges.reverse()
            }
        });
    }

    _libwebsocketRanking.FOnOpen(posAberturaSocket);
    _libwebsocketRanking.FOnMessage(posRecebimentoMensagemServidor);
    _libwebsocketRanking.iniciar();
</script>
</body>
</html>
